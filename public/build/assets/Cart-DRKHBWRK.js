import{f as K,r as o,i as A,s as L,j as e,P as q,k as E,E as H,F as O,d as P,B as $,u as X,q as G,W as U,y as R,G as W}from"./app-C3BOZ1X1.js";import{C as S,a as J,b as V,e as Y,c as _}from"./card-DMTEW9kf.js";import{B as N}from"./button-CPshFZPR.js";import{I as Z}from"./input-B13NeOK9.js";import{u as Q}from"./index-BFz2n0DQ.js";import{C as ee}from"./CustomerLayout-CB6d6aSv.js";import{c as te}from"./index-CtqNtBL0.js";import{P as se}from"./plus-BQXpuvKo.js";import{T as re}from"./trash-2-CyFkJAVG.js";import"./sheet-DIB6rJWg.js";import"./index-BdQq_4o_.js";import"./badge-D2Hink_m.js";/**
 * @license lucide-react v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=te("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);var w="Checkbox",[ce,ve]=K(w),[oe,ne]=ce(w),D=o.forwardRef((a,l)=>{const{__scopeCheckbox:s,name:d,checked:c,defaultChecked:i,required:u,disabled:m,value:j="on",onCheckedChange:x,form:k,...C}=a,[h,b]=o.useState(null),y=A(l,p=>b(p)),v=o.useRef(!1),t=h?k||!!h.closest("form"):!0,[r=!1,n]=L({prop:c,defaultProp:i,onChange:x}),T=o.useRef(r);return o.useEffect(()=>{const p=h==null?void 0:h.form;if(p){const g=()=>n(T.current);return p.addEventListener("reset",g),()=>p.removeEventListener("reset",g)}},[h,n]),e.jsxs(oe,{scope:s,state:r,disabled:m,children:[e.jsx(q.button,{type:"button",role:"checkbox","aria-checked":f(r)?"mixed":r,"aria-required":u,"data-state":F(r),"data-disabled":m?"":void 0,disabled:m,value:j,...C,ref:y,onKeyDown:E(a.onKeyDown,p=>{p.key==="Enter"&&p.preventDefault()}),onClick:E(a.onClick,p=>{n(g=>f(g)?!0:!g),t&&(v.current=p.isPropagationStopped(),v.current||p.stopPropagation())})}),t&&e.jsx(ie,{control:h,bubbles:!v.current,name:d,value:j,checked:r,required:u,disabled:m,form:k,style:{transform:"translateX(-100%)"},defaultChecked:f(i)?!1:i})]})});D.displayName=w;var z="CheckboxIndicator",B=o.forwardRef((a,l)=>{const{__scopeCheckbox:s,forceMount:d,...c}=a,i=ne(z,s);return e.jsx(H,{present:d||f(i.state)||i.state===!0,children:e.jsx(q.span,{"data-state":F(i.state),"data-disabled":i.disabled?"":void 0,...c,ref:l,style:{pointerEvents:"none",...a.style}})})});B.displayName=z;var ie=a=>{const{control:l,checked:s,bubbles:d=!0,defaultChecked:c,...i}=a,u=o.useRef(null),m=Q(s),j=O(l);o.useEffect(()=>{const k=u.current,C=window.HTMLInputElement.prototype,b=Object.getOwnPropertyDescriptor(C,"checked").set;if(m!==s&&b){const y=new Event("click",{bubbles:d});k.indeterminate=f(s),b.call(k,f(s)?!1:s),k.dispatchEvent(y)}},[m,s,d]);const x=o.useRef(f(s)?!1:s);return e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:c??x.current,...i,tabIndex:-1,ref:u,style:{...a.style,...j,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function f(a){return a==="indeterminate"}function F(a){return f(a)?"indeterminate":a?"checked":"unchecked"}var M=D,le=B;const I=o.forwardRef(({className:a,...l},s)=>e.jsx(M,{ref:s,className:P("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...l,children:e.jsx(le,{className:P("flex items-center justify-center text-current"),children:e.jsx($,{className:"h-4 w-4"})})}));I.displayName=M.displayName;function ge(){const{toast:a}=X(),{items:l}=G().props,[s,d]=o.useState(l),[c,i]=o.useState(l),u=c.reduce((t,r)=>t+r.price*r.quantity,0),m=s.length>0&&s.every(t=>t.selected),{data:j,setData:x,post:k}=U({items:[],totalPrice:0});o.useEffect(()=>{i(s.filter(t=>t.selected))},[s]),o.useEffect(()=>{console.log("items",c),x("items",c),x("totalPrice",u)},[c,u]);const C=(t,r)=>{if(r>=0){d(s.map(n=>n.product_id===t?{...n,quantity:r}:n));try{R.put(route("customer.cart.product-quantity",t),{quantity:r},{preserveState:!0,onError:n=>{a({title:"Error",description:(n==null?void 0:n.quantity)??"Update quantity failed"})}})}catch(n){console.error(n)}}},h=async t=>{d(s.filter(r=>r.product_id!==t));try{await R.delete(route("customer.cart.remove-product",t),{preserveState:!0,onError:()=>{a({title:"Error",description:"Remove product failed"})}})}catch(r){console.error("Error during request:",r)}},b=t=>{d(s.map(r=>r.product_id===t?{...r,selected:!r.selected}:r))},y=()=>{d(s.map(t=>({...t,selected:!m})))},v=async()=>{await x("items",c),await x("totalPrice",u);try{const t=await W.post(route("customer.transactions.checkout"),{items:c,total_price:u});t.status===200&&(document.location.href=t.data.url)}catch(t){console.error(t)}};return e.jsx(ee,{title:"Keranjang",children:e.jsx("div",{className:"px-6",children:e.jsxs(S,{className:"w-full max-w-5xl mx-auto",children:[e.jsxs(J,{children:[e.jsx(V,{children:"Keranjang Belanja"}),e.jsx(Y,{children:"Checkout semua barang belanjaanmu di keranjang"})]}),e.jsx(_,{children:s.length===0?e.jsx("p",{className:"text-center text-gray-500",children:"Kerajangmu kosong"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex items-center",children:[e.jsx(I,{id:"select-all",checked:m,onCheckedChange:t=>y()}),e.jsx("label",{htmlFor:"select-all",className:"ml-2 text-sm font-medium",children:"Select All Items"})]}),e.jsx("div",{className:"space-y-4",children:l.map(t=>e.jsx(S,{children:e.jsx(_,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(I,{id:`item-${t.product_id}`,checked:m||t.selected,onCheckedChange:()=>b(t.product_id)}),e.jsx("div",{className:"w-20 h-20 relative",style:{backgroundImage:`url(${t.image})`,backgroundSize:"cover",backgroundPosition:"center",width:"100px",aspectRatio:"1/1",borderRadius:"8px"}}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("label",{htmlFor:`item-${t.product_id}`,className:"text-lg font-semibold",children:t.name}),e.jsx("p",{className:"text-gray-600",children:Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(t.price)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{variant:"outline",size:"icon",onClick:()=>C(t.product_id,t.quantity-1),children:e.jsx(ae,{className:"h-4 w-4"})}),e.jsx(Z,{type:"number",value:t.quantity,onChange:r=>C(t.product_id,parseInt(r.target.value)||0),className:"w-16 text-center"}),e.jsx(N,{variant:"outline",size:"icon",onClick:()=>C(t.product_id,t.quantity+1),children:e.jsx(se,{className:"h-4 w-4"})})]}),e.jsxs(N,{variant:"destructive",size:"icon",onClick:()=>h(t.product_id),children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Remove item"})]})]})})},t.product_id))}),e.jsxs("div",{className:"mt-8 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-xl font-semibold",children:["Total (",c.length," ","items):"]}),e.jsx("span",{className:"text-xl font-bold",children:Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(u)})]}),e.jsxs(N,{className:"w-full",size:"lg",disabled:c.length===0,onClick:v,children:["Proceed to Checkout (",c.length," items)"]})]})]})})]})})})}export{ge as default};
